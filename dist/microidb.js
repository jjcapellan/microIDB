function e(e,n,r){var t=(e=e.toLowerCase()).indexOf(n)+n.length;return t<n.length?0:parseInt(e.substring(t,t+r))}var n=function(e,n,r){void 0===r&&(r=s);try{var t=function(){function n(){var n=f.transaction(u,"readwrite").objectStore(u).count(e);n.onerror=function(){r(!1),v()},n.onsuccess=function(){r(n.result>0),v()}}var t=function(){if(0==f.objectStoreNames.length)return Promise.resolve(h()).then(function(e){e||(r(!1),v())})}();return t&&t.then?t.then(n):n()},o=function(){if(!f)return Promise.resolve(d()).then(function(e){e||(r(!1),v())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},r=function(e,n,r){void 0===r&&(r=s);try{var t=function(){function t(){var t=f.transaction(u,"readwrite").objectStore(u).put(n,e);t.onerror=function(){r(!1),v()},t.onsuccess=function(){r(!0),v()}}var o=function(){if(0==f.objectStoreNames.length)return Promise.resolve(h()).then(function(e){e||(r(!1),v())})}();return o&&o.then?o.then(t):t()},o=function(){if(!f)return Promise.resolve(d()).then(function(e){e||(r(!1),v())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},t=function(e,n,r){void 0===r&&(r=s);try{var t=function(){0==f.objectStoreNames.length&&(console.warn(c+" database is empty"),r(!1),v());var n=f.transaction(u,"readwrite").objectStore(u).delete(e);n.onsuccess=function(){r(!0),v()},n.onerror=function(){r(!1),v()}},o=function(){if(!f)return Promise.resolve(d()).then(function(e){e||(r(!1),v())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},o=function(e,n,r){void 0===r&&(r=s);try{var t=function(){0==f.objectStoreNames.length&&(console.warn(c+" database is empty"),r(null),v());var n=f.transaction(u,"readonly").objectStore(u).get(e);n.onsuccess=function(){r(n.result),v()},n.onerror=function(){r(null),v()}},o=function(){if(!f)return Promise.resolve(d()).then(function(e){e||(r(null),v())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},i=function(e,n,r){void 0===r&&(r=s);try{var t=function(){function e(){var e=f.transaction(u,"readwrite").objectStore(u).clear();e.onerror=function(){r(!1),v()},e.onsuccess=function(){r(!0),v()}}var n=function(){if(0==f.objectStoreNames.length)return Promise.resolve(h()).then(function(e){e||(r(!1),v())})}();return n&&n.then?n.then(e):e()},o=function(){if(!f)return Promise.resolve(d()).then(function(e){e||(r(!1),v())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},c="microiDB",u="microObjStore",s=function(){},f=null,a=!0,l=[];function v(){var e=l.shift();e?(a=!1,e.fn(e.key,e.value,e.onComplete)):a=!0}function h(){var e;e=f.version,f.close();var n=window.indexedDB.open(c,e+1);return new Promise(function(e){n.onupgradeneeded=function(){f=n.result;try{f.createObjectStore(u)}catch(n){e(!1)}},n.onsuccess=function(){e(!0)}})}function d(){var e=indexedDB.open(c);return new Promise(function(n){e.onerror=function(){return n(!1)},e.onsuccess=function(){try{return f=e.result,n(!0),Promise.resolve()}catch(e){return Promise.reject(e)}},e.onblocked=function(){n(!1)}})}exports.checkSupport=function(){if(!indexedDB)return!1;var n=navigator.userAgent.toLowerCase(),r=!1;switch(!0){case n.indexOf("edge")>-1:r=!1;break;case n.indexOf("edg/")>-1:r=!0;break;case n.indexOf("opr")>-1&&!!window.opr:r=!0,e(n,"opr/",2)<15&&(r=!1);break;case n.indexOf("chrome")>-1&&!!window.chrome:r=!0,e(n,"chrome/",2)<48&&(r=!1);break;case n.indexOf("trident")>-1:r=!1;break;case n.indexOf("firefox")>-1:r=!0,e(n,"firefox/",2)<16&&(r=!1);break;case n.indexOf("safari")>-1&&n.indexOf("mobile")>-1:case n.indexOf("safari")>-1&&-1==n.indexOf("mobile"):r=!0,e(n,"version/",2)<15&&(r=!1)}return r},exports.clear=function(e){void 0===e&&(e=s),l.push({fn:i,key:null,value:null,onComplete:e}),a&&v()},exports.exists=function(e,r){l.push({fn:n,key:e,value:null,onComplete:r}),a&&v()},exports.get=function(e,n){l.push({fn:o,key:e,value:null,onComplete:n}),a&&v()},exports.remove=function(e,n){void 0===n&&(n=s),l.push({fn:t,key:e,value:null,onComplete:n}),a&&v()},exports.set=function(e,n,t){void 0===t&&(t=s),l.push({fn:r,key:e,value:n,onComplete:t}),a&&v()};
