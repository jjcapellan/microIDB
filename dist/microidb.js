var e=function(e,r,n){void 0===n&&(n=u);try{var o=s.transaction(c,"readwrite").objectStore(c).put(r,e);return o.onerror=function(){n(!1),i()},o.onsuccess=function(){n(!0),i()},Promise.resolve()}catch(e){return Promise.reject(e)}},r=function(e,r,n){void 0===n&&(n=u);try{var o=s.transaction(c,"readwrite").objectStore(c).delete(e);return o.onsuccess=function(){n(!0),i()},o.onerror=function(){n(!1),i()},Promise.resolve()}catch(e){return Promise.reject(e)}},n=function(e,r,n){void 0===n&&(n=u);try{var o=s.transaction(c,"readonly").objectStore(c).get(e);return o.onsuccess=function(){n(o.result),i()},o.onerror=function(){n(!1),i()},Promise.resolve()}catch(e){return Promise.reject(e)}},o=function(e,r,n){void 0===n&&(n=u);try{var o=s.transaction(c,"readwrite").objectStore(c).count(e);return o.onerror=function(){n(!1),i()},o.onsuccess=function(){n(o.result>0),i()},Promise.resolve()}catch(e){return Promise.reject(e)}},t=function(e,r,n){void 0===n&&(n=u);try{var o=s.transaction(c,"readwrite").objectStore(c).clear();return o.onerror=function(){n(!1),i()},o.onsuccess=function(){n(!0),i()},Promise.resolve()}catch(e){return Promise.reject(e)}},i=function(){try{var e,r=function(r){var o;if(e)return r;function t(e){if(o)return e;n.fn(n.key,n.value,n.onComplete)}var i=function(){if(0==s.objectStoreNames.length)return Promise.resolve(function(){var e;e=s.version,s.close();var r=window.indexedDB.open("microiDB",e+1);return new Promise(function(e){r.onupgradeneeded=function(){s=r.result;try{s.createObjectStore(c)}catch(r){e(!1)}},r.onsuccess=function(){e(!0)}})}()).then(function(e){e||(n.onComplete(!1),console.error("Error opening objectStore"),o=1)})}();return i&&i.then?i.then(t):t(i)},n=f.shift();if(!n)return a=!0,Promise.resolve();a=!1;var o=function(){if(!s)return Promise.resolve((r=indexedDB.open("microiDB"),new Promise(function(e){r.onerror=function(){return e(!1)},r.onsuccess=function(){try{return s=r.result,e(!0),Promise.resolve()}catch(e){return Promise.reject(e)}},r.onblocked=function(){e(!1)}}))).then(function(r){r||(n.onComplete(!1),console.error("Error opening database"),e=1)});var r}();return Promise.resolve(o&&o.then?o.then(r):r(o))}catch(e){return Promise.reject(e)}},c="microObjStore",u=function(){},s=null,a=!0,f=[];exports.checkSupport=function(){if(window&&!window.indexedDB)return!1;var e=navigator.userAgent.toLowerCase(),r=!0;return new RegExp(/.+(ipod|iphone|ipad|macintosh).+version\/.+safari.+/).test(e)&&-1==e.indexOf("edgios")&&(function(e,r,n){var o=e.indexOf(r)+r.length;return o<r.length?0:parseInt(e.substring(o,o+2))}(e,"version/")<10||e.indexOf("version/14.1")>-1)&&(r=!1),r},exports.clear=function(e){void 0===e&&(e=u),f.push({fn:t,key:null,value:null,onComplete:e}),a&&i()},exports.exists=function(e,r){f.push({fn:o,key:e,value:null,onComplete:r}),a&&i()},exports.get=function(e,r){f.push({fn:n,key:e,value:null,onComplete:r}),a&&i()},exports.remove=function(e,n){void 0===n&&(n=u),f.push({fn:r,key:e,value:null,onComplete:n}),a&&i()},exports.set=function(r,n,o){void 0===o&&(o=u),f.push({fn:e,key:r,value:n,onComplete:o}),a&&i()};
