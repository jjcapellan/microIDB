!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e||self).idb={})}(this,function(e){var n=function(e,n,r){void 0===r&&(r=f);try{var o=a.transaction(s,"readwrite").objectStore(s).put(n,e);return o.onerror=function(){r(!1),c()},o.onsuccess=function(){r(!0),c()},Promise.resolve()}catch(e){return Promise.reject(e)}},r=function(e,n,r){void 0===r&&(r=f);try{var o=a.transaction(s,"readwrite").objectStore(s).delete(e);return o.onsuccess=function(){r(!0),c()},o.onerror=function(){r(!1),c()},Promise.resolve()}catch(e){return Promise.reject(e)}},o=function(e,n,r){void 0===r&&(r=f);try{var o=a.transaction(s,"readonly").objectStore(s).get(e);return o.onsuccess=function(){r(o.result),c()},o.onerror=function(){r(!1),c()},Promise.resolve()}catch(e){return Promise.reject(e)}},t=function(e,n,r){void 0===r&&(r=f);try{var o=a.transaction(s,"readwrite").objectStore(s).count(e);return o.onerror=function(){r(!1),c()},o.onsuccess=function(){r(o.result>0),c()},Promise.resolve()}catch(e){return Promise.reject(e)}},i=function(e,n,r){void 0===r&&(r=f);try{var o=a.transaction(s,"readwrite").objectStore(s).clear();return o.onerror=function(){r(!1),c()},o.onsuccess=function(){r(!0),c()},Promise.resolve()}catch(e){return Promise.reject(e)}},c=function(){try{var e,n=function(n){var o;if(e)return n;function t(e){if(o)return e;r.fn(r.key,r.value,r.onComplete)}var i=function(){if(0==a.objectStoreNames.length)return Promise.resolve(function(){var e;e=a.version,a.close();var n=window.indexedDB.open(u,e+1);return new Promise(function(e){n.onupgradeneeded=function(){a=n.result;try{a.createObjectStore(s)}catch(n){e(!1)}},n.onsuccess=function(){e(!0)}})}()).then(function(e){e||(r.onComplete(!1),console.error("Error opening objectStore"),o=1)})}();return i&&i.then?i.then(t):t(i)},r=v.shift();if(!r)return l=!0,Promise.resolve();l=!1;var o=function(){if(!a)return Promise.resolve((n=indexedDB.open(u),new Promise(function(e){n.onerror=function(){return e(!1)},n.onsuccess=function(){try{return a=n.result,e(!0),Promise.resolve()}catch(e){return Promise.reject(e)}},n.onblocked=function(){e(!1)}}))).then(function(n){n||(r.onComplete(!1),console.error("Error opening database"),e=1)});var n}();return Promise.resolve(o&&o.then?o.then(n):n(o))}catch(e){return Promise.reject(e)}},u="microiDB",s="microObjStore",f=function(){},a=null,l=!0,v=[];e.checkSupport=function(){if(window&&!window.indexedDB)return!1;var e=navigator.userAgent.toLowerCase(),n=!0;return new RegExp(/.+(ipod|iphone|ipad|macintosh).+version\/.+safari.+/).test(e)&&-1==e.indexOf("edgios")&&(function(e,n,r){var o=e.indexOf(n)+n.length;return o<n.length?0:parseInt(e.substring(o,o+2))}(e,"version/")<10||e.indexOf("version/14.1")>-1)&&(n=!1),n},e.clear=function(e){void 0===e&&(e=f),v.push({fn:i,key:null,value:null,onComplete:e}),l&&c()},e.exists=function(e,n){v.push({fn:t,key:e,value:null,onComplete:n}),l&&c()},e.get=function(e,n){v.push({fn:o,key:e,value:null,onComplete:n}),l&&c()},e.remove=function(e,n){void 0===n&&(n=f),v.push({fn:r,key:e,value:null,onComplete:n}),l&&c()},e.set=function(e,r,o){void 0===o&&(o=f),v.push({fn:n,key:e,value:r,onComplete:o}),l&&c()}});
