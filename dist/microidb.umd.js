!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e||self).idb={})}(this,function(e){function n(e,n,t){var r=(e=e.toLowerCase()).indexOf(n)+n.length;return r<n.length?0:parseInt(e.substring(r,r+t))}var t=function(e,n,t){void 0===t&&(t=f);try{var r=function(){function n(){var n=a.transaction(s,"readwrite").objectStore(s).count(e);n.onerror=function(){t(!1),h()},n.onsuccess=function(){t(n.result>0),h()}}var r=function(){if(0==a.objectStoreNames.length)return Promise.resolve(v()).then(function(e){e||(t(!1),h())})}();return r&&r.then?r.then(n):n()},o=function(){if(!a)return Promise.resolve(m()).then(function(e){e||(t(!1),h())})}();return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}},r=function(e,n,t){void 0===t&&(t=f);try{var r=function(){function r(){var r=a.transaction(s,"readwrite").objectStore(s).put(n,e);r.onerror=function(){t(!1),h()},r.onsuccess=function(){t(!0),h()}}var o=function(){if(0==a.objectStoreNames.length)return Promise.resolve(v()).then(function(e){e||(t(!1),h())})}();return o&&o.then?o.then(r):r()},o=function(){if(!a)return Promise.resolve(m()).then(function(e){e||(t(!1),h())})}();return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}},o=function(e,n,t){void 0===t&&(t=f);try{var r=function(){0==a.objectStoreNames.length&&(console.warn(u+" database is empty"),t(!1),h());var n=a.transaction(s,"readwrite").objectStore(s).delete(e);n.onsuccess=function(){t(!0),h()},n.onerror=function(){t(!1),h()}},o=function(){if(!a)return Promise.resolve(m()).then(function(e){e||(t(!1),h())})}();return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}},i=function(e,n,t){void 0===t&&(t=f);try{var r=function(){0==a.objectStoreNames.length&&(console.warn(u+" database is empty"),t(null),h());var n=a.transaction(s,"readonly").objectStore(s).get(e);n.onsuccess=function(){t(n.result),h()},n.onerror=function(){t(null),h()}},o=function(){if(!a)return Promise.resolve(m()).then(function(e){e||(t(null),h())})}();return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}},c=function(e,n,t){void 0===t&&(t=f);try{var r=function(){function e(){var e=a.transaction(s,"readwrite").objectStore(s).clear();e.onerror=function(){t(!1),h()},e.onsuccess=function(){t(!0),h()}}var n=function(){if(0==a.objectStoreNames.length)return Promise.resolve(v()).then(function(e){e||(t(!1),h())})}();return n&&n.then?n.then(e):e()},o=function(){if(!a)return Promise.resolve(m()).then(function(e){e||(t(!1),h())})}();return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}},u="microiDB",s="microObjStore",f=function(){},a=null,l=!0,d=[];function h(){var e=d.shift();e?(l=!1,e.fn(e.key,e.value,e.onComplete)):l=!0}function v(){var e;e=a.version,a.close();var n=window.indexedDB.open(u,e+1);return new Promise(function(e){n.onupgradeneeded=function(){a=n.result;try{a.createObjectStore(s)}catch(n){e(!1)}},n.onsuccess=function(){e(!0)}})}function m(){var e=indexedDB.open(u);return new Promise(function(n){e.onerror=function(){return n(!1)},e.onsuccess=function(){try{return a=e.result,n(!0),Promise.resolve()}catch(e){return Promise.reject(e)}},e.onblocked=function(){n(!1)}})}e.checkSupport=function(){if(!indexedDB)return!1;var e=navigator.userAgent.toLowerCase(),t=!1;switch(!0){case e.indexOf("edge")>-1:t=!1;break;case e.indexOf("edg/")>-1:t=!0;break;case e.indexOf("opr")>-1&&!!window.opr:t=!0,n(e,"opr/",2)<15&&(t=!1);break;case e.indexOf("chrome")>-1&&!!window.chrome:t=!0,n(e,"chrome/",2)<48&&(t=!1);break;case e.indexOf("trident")>-1:t=!1;break;case e.indexOf("firefox")>-1:t=!0,n(e,"firefox/",2)<16&&(t=!1);break;case e.indexOf("safari")>-1&&e.indexOf("mobile")>-1:case e.indexOf("safari")>-1&&-1==e.indexOf("mobile"):t=!0,n(e,"version/",2)<15&&(t=!1)}return t},e.clear=function(e){void 0===e&&(e=f),d.push({fn:c,key:null,value:null,onComplete:e}),l&&h()},e.exists=function(e,n){d.push({fn:t,key:e,value:null,onComplete:n}),l&&h()},e.get=function(e,n){d.push({fn:i,key:e,value:null,onComplete:n}),l&&h()},e.remove=function(e,n){void 0===n&&(n=f),d.push({fn:o,key:e,value:null,onComplete:n}),l&&h()},e.set=function(e,n,t){void 0===t&&(t=f),d.push({fn:r,key:e,value:n,onComplete:t}),l&&h()}});
