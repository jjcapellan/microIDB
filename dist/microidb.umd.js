!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e||self).idb={})}(this,function(e){function n(e,n,t){var r=(e=e.toLowerCase()).indexOf(n)+n.length;return r<n.length?0:parseInt(e.substring(r,r+t))}var t=function(e,n,t){void 0===t&&(t=s);try{var r=function(){function r(){var r=f.transaction(u,"readwrite").objectStore(u).put(n,e);r.onerror=function(){t(!1),d()},r.onsuccess=function(){t(!0),d()}}var o=function(){if(0==f.objectStoreNames.length)return Promise.resolve(v()).then(function(e){e||(t(!1),d())})}();return o&&o.then?o.then(r):r()},o=function(){if(!f)return Promise.resolve(h()).then(function(e){e||(t(!1),d())})}();return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}},r=function(e,n,t){void 0===t&&(t=s);try{var r=function(){0==f.objectStoreNames.length&&(console.warn("TinyIdb database is empty"),t(!1),d());var n=f.transaction(u,"readwrite").objectStore(u).delete(e);n.onsuccess=function(){t(!0),d()},n.onerror=function(){t(!1),d()}},o=function(){if(!f)return Promise.resolve(h()).then(function(e){e||(t(!1),d())})}();return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}},o=function(e,n,t){void 0===t&&(t=s);try{var r=function(){0==f.objectStoreNames.length&&(console.warn("TinyIdb database is empty"),t(null),d());var n=f.transaction(u,"readonly").objectStore(u).get(e);n.onsuccess=function(){t(n.result),d()},n.onerror=function(){t(null),d()}},o=function(){if(!f)return Promise.resolve(h()).then(function(e){e||(t(null),d())})}();return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}},i=function(e,n,t){void 0===t&&(t=s);try{var r=function(){function e(){var e=f.transaction(u,"readwrite").objectStore(u).clear();e.onerror=function(){t(!1),d()},e.onsuccess=function(){t(!0),d()}}var n=function(){if(0==f.objectStoreNames.length)return Promise.resolve(v()).then(function(e){e||(t(!1),d())})}();return n&&n.then?n.then(e):e()},o=function(){if(!f)return Promise.resolve(h()).then(function(e){e||(t(!1),d())})}();return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}},c="tinyDB",u="tinyObjStore",s=function(){},f=null,a=!0,l=[];function d(){var e=l.shift();e?(a=!1,e.fn(e.key,e.value,e.onComplete)):a=!0}function v(){var e;e=f.version,f.close();var n=window.indexedDB.open(c,e+1);return new Promise(function(e){n.onupgradeneeded=function(){f=n.result;try{f.createObjectStore(u)}catch(n){e(!1)}},n.onsuccess=function(){e(!0)}})}function h(){var e=indexedDB.open(c);return new Promise(function(n){e.onerror=function(){return n(!1)},e.onsuccess=function(){try{return f=e.result,n(!0),Promise.resolve()}catch(e){return Promise.reject(e)}},e.onblocked=function(){n(!1)}})}e.checkSupport=function(){if(!indexedDB)return!1;var e=navigator.userAgent.toLowerCase(),t=!1;switch(!0){case e.indexOf("edge")>-1:t=!1;break;case e.indexOf("edg/")>-1:t=!0;break;case e.indexOf("opr")>-1&&!!window.opr:t=!0,n(e,"opr/",2)<15&&(t=!1);break;case e.indexOf("chrome")>-1&&!!window.chrome:t=!0,n(e,"chrome/",2)<48&&(t=!1);break;case e.indexOf("trident")>-1:t=!1;break;case e.indexOf("firefox")>-1:t=!0,n(e,"firefox/",2)<16&&(t=!1);break;case e.indexOf("safari")>-1&&e.indexOf("mobile")>-1:case e.indexOf("safari")>-1&&-1==e.indexOf("mobile"):t=!0,n(e,"version/",2)<15&&(t=!1)}return t},e.clear=function(e){void 0===e&&(e=s),l.push({fn:i,key:null,value:null,onComplete:e}),a&&d()},e.get=function(e,n){l.push({fn:o,key:e,value:null,onComplete:n}),a&&d()},e.remove=function(e,n){void 0===n&&(n=s),l.push({fn:r,key:e,value:null,onComplete:n}),a&&d()},e.set=function(e,n,r){void 0===r&&(r=s),l.push({fn:t,key:e,value:n,onComplete:r}),a&&d()}});
