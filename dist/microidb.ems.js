function e(){if(!indexedDB)return!1;var e=navigator.userAgent.toLowerCase(),r=!1;switch(!0){case e.indexOf("edge")>-1:r=!1;break;case e.indexOf("edg/")>-1:r=!0;break;case e.indexOf("opr")>-1&&!!window.opr:r=!0,n(e,"opr/",2)<15&&(r=!1);break;case e.indexOf("chrome")>-1&&!!window.chrome:r=!0,n(e,"chrome/",2)<48&&(r=!1);break;case e.indexOf("trident")>-1:r=!1;break;case e.indexOf("firefox")>-1:r=!0,n(e,"firefox/",2)<16&&(r=!1);break;case e.indexOf("safari")>-1&&e.indexOf("mobile")>-1:case e.indexOf("safari")>-1&&-1==e.indexOf("mobile"):r=!0,n(e,"version/",2)<15&&(r=!1)}return r}function n(e,n,r){var t=(e=e.toLowerCase()).indexOf(n)+n.length;return t<n.length?0:parseInt(e.substring(t,t+r))}var r=function(e,n,r){void 0===r&&(r=f);try{var t=function(){function n(){var n=a.transaction(s,"readwrite").objectStore(s).count(e);n.onerror=function(){r(!1),P()},n.onsuccess=function(){r(n.result>0),P()}}var t=function(){if(0==a.objectStoreNames.length)return Promise.resolve(j()).then(function(e){e||(r(!1),P())})}();return t&&t.then?t.then(n):n()},o=function(){if(!a)return Promise.resolve(w()).then(function(e){e||(r(!1),P())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},t=function(e,n,r){void 0===r&&(r=f);try{var t=function(){function t(){var t=a.transaction(s,"readwrite").objectStore(s).put(n,e);t.onerror=function(){r(!1),P()},t.onsuccess=function(){r(!0),P()}}var o=function(){if(0==a.objectStoreNames.length)return Promise.resolve(j()).then(function(e){e||(r(!1),P())})}();return o&&o.then?o.then(t):t()},o=function(){if(!a)return Promise.resolve(w()).then(function(e){e||(r(!1),P())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},o=function(e,n,r){void 0===r&&(r=f);try{var t=function(){0==a.objectStoreNames.length&&(console.warn(u+" database is empty"),r(!1),P());var n=a.transaction(s,"readwrite").objectStore(s).delete(e);n.onsuccess=function(){r(!0),P()},n.onerror=function(){r(!1),P()}},o=function(){if(!a)return Promise.resolve(w()).then(function(e){e||(r(!1),P())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},i=function(e,n,r){void 0===r&&(r=f);try{var t=function(){0==a.objectStoreNames.length&&(console.warn(u+" database is empty"),r(null),P());var n=a.transaction(s,"readonly").objectStore(s).get(e);n.onsuccess=function(){r(n.result),P()},n.onerror=function(){r(null),P()}},o=function(){if(!a)return Promise.resolve(w()).then(function(e){e||(r(null),P())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},c=function(e,n,r){void 0===r&&(r=f);try{var t=function(){function e(){var e=a.transaction(s,"readwrite").objectStore(s).clear();e.onerror=function(){r(!1),P()},e.onsuccess=function(){r(!0),P()}}var n=function(){if(0==a.objectStoreNames.length)return Promise.resolve(j()).then(function(e){e||(r(!1),P())})}();return n&&n.then?n.then(e):e()},o=function(){if(!a)return Promise.resolve(w()).then(function(e){e||(r(!1),P())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},u="microiDB",s="microObjStore",f=function(){},a=null,l=!0,v=[];function h(e){void 0===e&&(e=f),v.push({fn:c,key:null,value:null,onComplete:e}),l&&P()}function d(e,n,r){void 0===r&&(r=f),v.push({fn:t,key:e,value:n,onComplete:r}),l&&P()}function m(e,n){void 0===n&&(n=f),v.push({fn:o,key:e,value:null,onComplete:n}),l&&P()}function b(e,n){v.push({fn:i,key:e,value:null,onComplete:n}),l&&P()}function p(e,n){v.push({fn:r,key:e,value:null,onComplete:n}),l&&P()}function P(){var e=v.shift();e?(l=!1,e.fn(e.key,e.value,e.onComplete)):l=!0}function j(){var e;e=a.version,a.close();var n=window.indexedDB.open(u,e+1);return new Promise(function(e){n.onupgradeneeded=function(){a=n.result;try{a.createObjectStore(s)}catch(n){e(!1)}},n.onsuccess=function(){e(!0)}})}function w(){var e=indexedDB.open(u);return new Promise(function(n){e.onerror=function(){return n(!1)},e.onsuccess=function(){try{return a=e.result,n(!0),Promise.resolve()}catch(e){return Promise.reject(e)}},e.onblocked=function(){n(!1)}})}export{e as checkSupport,h as clear,p as exists,b as get,m as remove,d as set};
