function e(){if(!indexedDB)return!1;var e=navigator.userAgent.toLowerCase(),r=!1;switch(!0){case e.indexOf("edge")>-1:r=!1;break;case e.indexOf("edg/")>-1:r=!0;break;case e.indexOf("opr")>-1&&!!window.opr:r=!0,n(e,"opr/",2)<15&&(r=!1);break;case e.indexOf("chrome")>-1&&!!window.chrome:r=!0,n(e,"chrome/",2)<48&&(r=!1);break;case e.indexOf("trident")>-1:r=!1;break;case e.indexOf("firefox")>-1:r=!0,n(e,"firefox/",2)<16&&(r=!1);break;case e.indexOf("safari")>-1&&e.indexOf("mobile")>-1:case e.indexOf("safari")>-1&&-1==e.indexOf("mobile"):r=!0,n(e,"version/",2)<15&&(r=!1)}return r}function n(e,n,r){var t=(e=e.toLowerCase()).indexOf(n)+n.length;return t<n.length?0:parseInt(e.substring(t,t+r))}var r=function(e,n,r){void 0===r&&(r=u);try{var t=function(){function t(){var t=s.transaction(c,"readwrite").objectStore(c).put(n,e);t.onerror=function(){r(!1),m()},t.onsuccess=function(){r(!0),m()}}var o=function(){if(0==s.objectStoreNames.length)return Promise.resolve(b()).then(function(e){e||(r(!1),m())})}();return o&&o.then?o.then(t):t()},o=function(){if(!s)return Promise.resolve(p()).then(function(e){e||(r(!1),m())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},t=function(e,n,r){void 0===r&&(r=u);try{var t=function(){0==s.objectStoreNames.length&&(console.warn("TinyIdb database is empty"),r(!1),m());var n=s.transaction(c,"readwrite").objectStore(c).delete(e);n.onsuccess=function(){r(!0),m()},n.onerror=function(){r(!1),m()}},o=function(){if(!s)return Promise.resolve(p()).then(function(e){e||(r(!1),m())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},o=function(e,n,r){void 0===r&&(r=u);try{var t=function(){0==s.objectStoreNames.length&&(console.warn("TinyIdb database is empty"),r(null),m());var n=s.transaction(c,"readonly").objectStore(c).get(e);n.onsuccess=function(){r(n.result),m()},n.onerror=function(){r(null),m()}},o=function(){if(!s)return Promise.resolve(p()).then(function(e){e||(r(null),m())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},i=function(e,n,r){void 0===r&&(r=u);try{var t=function(){function e(){var e=s.transaction(c,"readwrite").objectStore(c).clear();e.onerror=function(){r(!1),m()},e.onsuccess=function(){r(!0),m()}}var n=function(){if(0==s.objectStoreNames.length)return Promise.resolve(b()).then(function(e){e||(r(!1),m())})}();return n&&n.then?n.then(e):e()},o=function(){if(!s)return Promise.resolve(p()).then(function(e){e||(r(!1),m())})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(e){return Promise.reject(e)}},c="tinyObjStore",u=function(){},s=null,a=!0,f=[];function l(e){void 0===e&&(e=u),f.push({fn:i,key:null,value:null,onComplete:e}),a&&m()}function d(e,n,t){void 0===t&&(t=u),f.push({fn:r,key:e,value:n,onComplete:t}),a&&m()}function v(e,n){void 0===n&&(n=u),f.push({fn:t,key:e,value:null,onComplete:n}),a&&m()}function h(e,n){f.push({fn:o,key:e,value:null,onComplete:n}),a&&m()}function m(){var e=f.shift();e?(a=!1,e.fn(e.key,e.value,e.onComplete)):a=!0}function b(){var e;e=s.version,s.close();var n=window.indexedDB.open("tinyDB",e+1);return new Promise(function(e){n.onupgradeneeded=function(){s=n.result;try{s.createObjectStore(c)}catch(n){e(!1)}},n.onsuccess=function(){e(!0)}})}function p(){var e=indexedDB.open("tinyDB");return new Promise(function(n){e.onerror=function(){return n(!1)},e.onsuccess=function(){try{return s=e.result,n(!0),Promise.resolve()}catch(e){return Promise.reject(e)}},e.onblocked=function(){n(!1)}})}export{e as checkSupport,l as clear,h as get,v as remove,d as set};
