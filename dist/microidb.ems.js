var e=function(e,n,r){void 0===r&&(r=u);try{var o=s.transaction(c,"readwrite").objectStore(c).put(n,e);return o.onerror=function(){r(!1),i()},o.onsuccess=function(){r(!0),i()},Promise.resolve()}catch(e){return Promise.reject(e)}},n=function(e,n,r){void 0===r&&(r=u);try{var o=s.transaction(c,"readwrite").objectStore(c).delete(e);return o.onsuccess=function(){r(!0),i()},o.onerror=function(){r(!1),i()},Promise.resolve()}catch(e){return Promise.reject(e)}},r=function(e,n,r){void 0===r&&(r=u);try{var o=s.transaction(c,"readonly").objectStore(c).get(e);return o.onsuccess=function(){r(o.result),i()},o.onerror=function(){r(!1),i()},Promise.resolve()}catch(e){return Promise.reject(e)}},o=function(e,n,r){void 0===r&&(r=u);try{var o=s.transaction(c,"readwrite").objectStore(c).count(e);return o.onerror=function(){r(!1),i()},o.onsuccess=function(){r(o.result>0),i()},Promise.resolve()}catch(e){return Promise.reject(e)}},t=function(e,n,r){void 0===r&&(r=u);try{var o=s.transaction(c,"readwrite").objectStore(c).clear();return o.onerror=function(){r(!1),i()},o.onsuccess=function(){r(!0),i()},Promise.resolve()}catch(e){return Promise.reject(e)}},i=function(){try{var e,n=function(n){var o;if(e)return n;function t(e){if(o)return e;r.fn(r.key,r.value,r.onComplete)}var i=function(){if(0==s.objectStoreNames.length)return Promise.resolve(function(){var e;e=s.version,s.close();var n=window.indexedDB.open("microiDB",e+1);return new Promise(function(e){n.onupgradeneeded=function(){s=n.result;try{s.createObjectStore(c)}catch(n){e(!1)}},n.onsuccess=function(){e(!0)}})}()).then(function(e){e||(r.onComplete(!1),console.error("Error opening objectStore"),o=1)})}();return i&&i.then?i.then(t):t(i)},r=f.shift();if(!r)return a=!0,Promise.resolve();a=!1;var o=function(){if(!s)return Promise.resolve((n=indexedDB.open("microiDB"),new Promise(function(e){n.onerror=function(){return e(!1)},n.onsuccess=function(){try{return s=n.result,e(!0),Promise.resolve()}catch(e){return Promise.reject(e)}},n.onblocked=function(){e(!1)}}))).then(function(n){n||(r.onComplete(!1),console.error("Error opening database"),e=1)});var n}();return Promise.resolve(o&&o.then?o.then(n):n(o))}catch(e){return Promise.reject(e)}},c="microObjStore",u=function(){},s=null,a=!0,f=[];function l(){if(window&&!window.indexedDB)return!1;var e=navigator.userAgent.toLowerCase(),n=!0;return new RegExp(/.+(ipod|iphone|ipad|macintosh).+version\/.+safari.+/).test(e)&&-1==e.indexOf("edgios")&&(function(e,n,r){var o=e.indexOf(n)+n.length;return o<n.length?0:parseInt(e.substring(o,o+2))}(e,"version/")<10||e.indexOf("version/14.1")>-1)&&(n=!1),n}function v(e){void 0===e&&(e=u),f.push({fn:t,key:null,value:null,onComplete:e}),a&&i()}function d(e,n){f.push({fn:o,key:e,value:null,onComplete:n}),a&&i()}function m(e,n){f.push({fn:r,key:e,value:null,onComplete:n}),a&&i()}function h(e,r){void 0===r&&(r=u),f.push({fn:n,key:e,value:null,onComplete:r}),a&&i()}function p(n,r,o){void 0===o&&(o=u),f.push({fn:e,key:n,value:r,onComplete:o}),a&&i()}export{l as checkSupport,v as clear,d as exists,m as get,h as remove,p as set};
